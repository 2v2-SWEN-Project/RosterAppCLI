{% extends "layout.html" %}
{% block title %}Request Shift Swap â€” Scheduloid{% endblock %}

{% block nav_actions %}
<a href="{{ url_for('index_views.staff_dashboard') }}" class="link">Back to Dashboard</a>
{% endblock %}


{% block content %}
<!-- Page Header Panel -->
<section class="card">
    <div class="card-header">
        <h1 class="card-title">Request Shift Swap</h1>
        <p class="card-subtitle">Submit a request to swap shifts with another staff member</p>
    </div>
</section>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash-messages">
      {% for category, message in messages %}
        <li class="flash {{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 1.5rem;">
    <!-- Your Upcoming Shifts Panel -->
    <section class="card">
        <div class="card-header">
            <h2 class="card-title">Your Upcoming Shifts</h2>
            <p class="card-subtitle">Select a shift you'd like to request a swap for</p>
        </div>
        <div class="card-body">
            {% if my_shifts %}
            <table class="table compact">
                <thead>
                <tr>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Duration</th>
                </tr>
                </thead>
                <tbody>
                {% for shift in my_shifts %}
                <tr>
                    <td>{{ shift.start_time.strftime('%Y-%m-%d (%a)') }}</td>
                    <td>{{ shift.start_time.strftime('%H:%M') }} - {{ shift.end_time.strftime('%H:%M') }}</td>
                    <td>{{ "%.1f"|format((shift.end_time - shift.start_time).total_seconds() / 3600) }} hrs</td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div style="background: #0f172a; border-radius: 6px; padding: 1rem; text-align: center;">
                <p style="margin: 0; color: #94a3b8;">No upcoming shifts available for swap.</p>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Request Swap Form Panel -->
    <section class="card">
        <div class="card-header">
            <h2 class="card-title">Request Swap Form</h2>
            <p class="card-subtitle">Fill out the details to request a shift swap</p>
        </div>
        <div class="card-body">
            <form method="post" action="{{ url_for('index_views.request_swap') }}">
                <div class="flex-col">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="target-shift">Select Shift to Swap</label>
                        <select id="target-shift" name="shift_id" required>
                            <option value="">Choose a shift...</option>
                            {% if my_shifts %}
                                {% for shift in my_shifts %}
                                <option value="{{ shift.id }}">{{ shift.start_time.strftime('%Y-%m-%d %H:%M') }} - {{ shift.end_time.strftime('%H:%M') }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="target-staff">Propose Staff Member</label>
                        <select id="target-staff" name="target_staff" required>
                            <option value="">Choose staff member...</option>
                            {% if other_staff %}
                                {% for staff in other_staff %}
                                <option value="{{ staff.id }}">{{ staff.username }}</option>
                                {% endfor %}
                            {% endif %}
                        </select>
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="reason">Reason for Swap Request</label>
                        <textarea id="reason" name="reason" rows="4" placeholder="Explain why you need this shift swap..." required></textarea>
                    </div>
                    <div class="flex-row" style="margin-top: 0.5rem;">
                        <button type="submit" class="btn primary">Submit Swap Request</button>
                    </div>
                </div>
            </form>
        </div>
    </section>
</div>

<!-- Important Notice Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Important Notice</h2>
    </div>
    <div class="card-body">
        <div class="notice-box">
            <p>Your swap request will be submitted to an administrator for review. You will see the admin's response (Approved/Denied) in your "My Swap Requests" page.</p>
        </div>
    </div>
</section>

<!-- Quick Actions Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Quick Actions</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <button class="btn" onclick="location.href='{{ url_for('staff_views.staff_swap_requests') }}'">View My Requests</button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_shifts') }}'">My Shifts</button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_dashboard') }}'">Dashboard</button>
        </div>
    </div>
</section>
{% endblock %}
