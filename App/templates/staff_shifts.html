{% extends "layout.html" %}
{% block title %}My Shifts — Scheduloid{% endblock %}

{% block nav_actions %}
<a href="{{ url_for('index_views.staff_dashboard') }}" class="link">Back to Dashboard</a>
{% endblock %}

{% block content %}
<!-- Page Header Panel -->
<section class="card">
    <div class="card-header">
        <h1 class="card-title">My Shifts</h1>
        <p class="card-subtitle">View all your shifts and hours worked</p>
    </div>
</section>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash-messages">
      {% for category, message in messages %}
        <li class="flash {{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Filter Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Filter Shifts</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <a href="{{ url_for('index_views.staff_shifts') }}" class="btn {% if not request.args.get('filter') or request.args.get('filter') == 'all' %}primary{% endif %}">All Shifts</a>
            <a href="{{ url_for('index_views.staff_shifts', filter='upcoming') }}" class="btn {% if request.args.get('filter') == 'upcoming' %}primary{% endif %}">Upcoming</a>
            <a href="{{ url_for('index_views.staff_shifts', filter='completed') }}" class="btn {% if request.args.get('filter') == 'completed' %}primary{% endif %}">Completed</a>
        </div>
    </div>
</section>

<!-- Shifts Table Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Shift List</h2>
        <p class="card-subtitle">Showing {{ shifts|length if shifts else 0 }} shift(s)</p>
    </div>
    <div class="card-body">
        {% if shifts %}
        <table class="table">
            <thead>
            <tr>
                <th>Shift Date</th>
                <th>Scheduled Time</th>
                <th>Clock In</th>
                <th>Clock Out</th>
                <th>Hours</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            {% for shift in shifts %}
            <tr>
                <td>{{ shift.start_time.strftime('%Y-%m-%d (%a)') }}</td>
                <td>{{ shift.start_time.strftime('%H:%M') }} - {{ shift.end_time.strftime('%H:%M') }}</td>
                <td>{% if shift.clock_in %}{{ shift.clock_in.strftime('%H:%M') }}{% else %}—{% endif %}</td>
                <td>{% if shift.clock_out %}{{ shift.clock_out.strftime('%H:%M') }}{% else %}—{% endif %}</td>
                <td>{{ "%.1f"|format((shift.end_time - shift.start_time).total_seconds() / 3600) }}</td>
                <td>
                    {% if shift.clock_out %}
                        <span style="color: #14b8a6; font-weight: 600;">Completed</span>
                    {% elif shift.clock_in %}
                        <span style="color: #3b82f6; font-weight: 600;">In Progress</span>
                    {% else %}
                        <span style="color: #f59e0b; font-weight: 600;">Scheduled</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{{ url_for('index_views.staff_shift_details') }}?id={{ shift.id }}" class="btn" style="padding: 0.25rem 0.75rem; font-size: 0.85rem;">View</a>
                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div style="background: #0f172a; border-radius: 8px; padding: 2rem; text-align: center;">
            <p style="margin: 0; font-size: 1rem; color: #94a3b8;">No shifts found.</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #64748b;">Check back later for new shift assignments.</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Summary Statistics Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Summary Statistics</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <div class="stat-box">
                <p class="stat-label">Total Shifts</p>
                <p class="stat-value">{{ shifts|length if shifts else 0 }}</p>
            </div>
            <div class="stat-box">
                <p class="stat-label">Hours Worked</p>
                <p class="stat-value">{{ total_hours }}</p>
            </div>
            <div class="stat-box teal">
                <p class="stat-label">Completion Rate</p>
                <p class="stat-value">{{ completion_rate }}%</p>
            </div>
        </div>
    </div>
</section>

<!-- Quick Actions Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Quick Actions</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <button class="btn primary" onclick="location.href='{{ url_for('index_views.staff_clock') }}'">
                Clock In/Out
            </button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_schedule') }}'">
                View Schedule
            </button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.request_swap') }}'">
                Request Swap
            </button>
        </div>
    </div>
</section>
{% endblock %}
