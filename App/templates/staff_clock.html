{% extends "layout.html" %}
{% block title %}Clock In / Out — Scheduloid{% endblock %}

{% block nav_actions %}
<a href="{{ url_for('index_views.staff_dashboard') }}" class="link">Back to Dashboard</a>
{% endblock %}

{% block content %}
<!-- Page Header Panel -->
<section class="card">
    <div class="card-header">
        <h1 class="card-title">Clock In / Clock Out</h1>
        <p class="card-subtitle">Track your shift start and end times</p>
    </div>
</section>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash-messages">
      {% for category, message in messages %}
        <li class="flash {{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

{% if shift %}
<!-- Today's Shift Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Today's Shift</h2>
    </div>
    <div class="card-body">
        <div class="flex-col" style="gap: 0;">
            <div class="info-row">
                <span class="info-label">Shift Date</span>
                <span class="info-value">{{ shift.start_time[:10] if shift.start_time else 'N/A' }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Assigned Time</span>
                <span class="info-value">{{ shift.start_time[11:16] if shift.start_time else 'N/A' }} - {{ shift.end_time[11:16] if shift.end_time else 'N/A' }}</span>
            </div>
            <div class="info-row">
                <span class="info-label">Current Status</span>
                <span class="info-value">
                    {% if shift.clock_out %}
                        <span style="color: #14b8a6;">Completed</span>
                    {% elif shift.clock_in %}
                        <span style="color: #3b82f6;">In Progress</span>
                    {% else %}
                        <span style="color: #f59e0b;">Not Started</span>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>
</section>

<!-- Today's Record Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Today's Record</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <div class="stat-box">
                <p class="stat-label">Clock In Time</p>
                <p class="stat-value" style="font-size: 1.5rem;">{% if shift.clock_in %}{{ shift.clock_in[11:19] }}{% else %}—{% endif %}</p>
            </div>
            <div class="stat-box teal">
                <p class="stat-label">Clock Out Time</p>
                <p class="stat-value" style="font-size: 1.5rem;">{% if shift.clock_out %}{{ shift.clock_out[11:19] }}{% else %}—{% endif %}</p>
            </div>
        </div>
    </div>
</section>

<!-- Clock Actions Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Clock Actions</h2>
    </div>
    <div class="card-body">
        <form method="post" action="{{ url_for('index_views.staff_clock') }}">
            <input type="hidden" name="shift_id" value="{{ shift.id }}">
            <div class="flex-row">
                <button type="submit" name="action" value="clock_in" class="btn primary" style="padding: 0.75rem 2rem;" {% if shift.clock_in %}disabled style="opacity: 0.5; cursor: not-allowed; padding: 0.75rem 2rem;"{% endif %}>
                    Clock In
                </button>
                <button type="submit" name="action" value="clock_out" class="btn success" style="padding: 0.75rem 2rem;" {% if not shift.clock_in or shift.clock_out %}disabled style="opacity: 0.5; cursor: not-allowed; padding: 0.75rem 2rem;"{% endif %}>
                    Clock Out
                </button>
            </div>
        </form>
    </div>
</section>

{% else %}
<!-- No Shift Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Shift Information</h2>
    </div>
    <div class="card-body">
        <div style="background: #0f172a; border-radius: 8px; padding: 2rem; text-align: center;">
            <p style="margin: 0; font-size: 1rem; color: #94a3b8;">You currently have no shifts assigned for today.</p>
            <p style="margin: 0.5rem 0 0 0; font-size: 0.9rem; color: #64748b;">Contact your administrator to request shift assignments.</p>
        </div>
    </div>
</section>
{% endif %}

<!-- Important Notice Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Important Notice</h2>
    </div>
    <div class="card-body">
        <div class="notice-box">
            <p>Please ensure you clock in when you arrive and clock out when you leave. Accurate records are important for payroll and scheduling.</p>
        </div>
    </div>
</section>

<!-- Quick Actions Panel -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Quick Actions</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_dashboard') }}'">Dashboard</button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_shifts') }}'">My Shifts</button>
            <button class="btn" onclick="location.href='{{ url_for('index_views.staff_schedule') }}'">My Schedule</button>
        </div>
    </div>
</section>
{% endblock %}
