{% extends "layout.html" %}
{% block title %}Shift Swap Requests â€” Rostering App{% endblock %}

{% block nav_actions %}
<a href="{{ url_for('index_views.admin_dashboard') }}" class="link">Back to Dashboard</a>
{% endblock %}

{% block content %}
<section class="card">
    <h1 class="card-title">Shift Swap Requests</h1>
    <p style="margin: 0 0 1.5rem 0; font-size: 0.9rem; color: #cbd5e1; font-weight: 600;">Review and manage staff shift swap requests</p>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flash-messages">
          {% for category, message in messages %}
            <li class="flash {{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    <!-- Pending Requests Section -->
    <div class="requests-section">
        <h2 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: #cbd5e1; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
            <span class="status-badge pending">PENDING</span>
            Pending Requests ({{ pending_requests|length }})
        </h2>
        
        {% if pending_requests %}
            <div class="requests-list">
                {% for swap_request in pending_requests %}
                <div class="request-card">
                    <div class="request-content">
                        <div class="request-header">
                            <h3 style="margin: 0 0 0.25rem 0; font-size: 1rem; color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</h3>
                            <p style="margin: 0; font-size: 0.85rem; color: #94a3b8;">{{ swap_request.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>

                        <div class="request-details">
                            <div class="detail-row">
                                <span class="detail-label">Shift Date:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%Y-%m-%d') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Shift Time:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%H:%M') }} - {{ swap_request.shift.end_time.strftime('%H:%M') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Reason:</span>
                                <span class="detail-value">{{ swap_request.reason or 'No reason provided' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Requested Staff:</span>
                                <span class="detail-value">{{ swap_request.requested_staff.username }}</span>
                            </div>
                        </div>
                    </div>

                    <div class="request-actions">
                        <form method="POST" style="display: inline;">
                            <input type="hidden" name="request_id" value="{{ swap_request.id }}">
                            <input type="hidden" name="action" value="approve">
                            <button type="submit" class="btn approve">Approve</button>
                        </form>
                        <form method="POST" style="display: inline;">
                            <input type="hidden" name="request_id" value="{{ swap_request.id }}">
                            <input type="hidden" name="action" value="deny">
                            <button type="submit" class="btn deny">Deny</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-requests">No pending requests</div>
        {% endif %}
    </div>

    <!-- Approved Requests Section -->
    <div class="requests-section">
        <h2 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: #cbd5e1; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
            <span class="status-badge approved">APPROVED</span>
            Approved Requests ({{ approved_requests|length }})
        </h2>
        
        {% if approved_requests %}
            <div class="requests-list">
                {% for swap_request in approved_requests %}
                <div class="request-card approved">
                    <div class="request-content">
                        <div class="request-header">
                            <h3 style="margin: 0 0 0.25rem 0; font-size: 1rem; color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</h3>
                            <p style="margin: 0; font-size: 0.85rem; color: #94a3b8;">{{ swap_request.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>

                        <div class="request-details">
                            <div class="detail-row">
                                <span class="detail-label">Shift Date:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%Y-%m-%d') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Shift Time:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%H:%M') }} - {{ swap_request.shift.end_time.strftime('%H:%M') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Reason:</span>
                                <span class="detail-value">{{ swap_request.reason or 'No reason provided' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Requested Staff:</span>
                                <span class="detail-value">{{ swap_request.requested_staff.username }}</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <span style="display: inline-block; background-color: #d1fae5; color: #065f46; padding: 0.35rem 0.75rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.3px;">APPROVED</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-requests">No approved requests</div>
        {% endif %}
    </div>

    <!-- Denied Requests Section -->
    <div class="requests-section">
        <h2 style="margin: 0 0 1rem 0; font-size: 0.95rem; color: #cbd5e1; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;">
            <span class="status-badge denied">DENIED</span>
            Denied Requests ({{ denied_requests|length }})
        </h2>
        
        {% if denied_requests %}
            <div class="requests-list">
                {% for swap_request in denied_requests %}
                <div class="request-card denied">
                    <div class="request-content">
                        <div class="request-header">
                            <h3 style="margin: 0 0 0.25rem 0; font-size: 1rem; color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</h3>
                            <p style="margin: 0; font-size: 0.85rem; color: #94a3b8;">{{ swap_request.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
                        </div>

                        <div class="request-details">
                            <div class="detail-row">
                                <span class="detail-label">Shift Date:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%Y-%m-%d') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Shift Time:</span>
                                <span class="detail-value">{{ swap_request.shift.start_time.strftime('%H:%M') }} - {{ swap_request.shift.end_time.strftime('%H:%M') }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Reason:</span>
                                <span class="detail-value">{{ swap_request.reason or 'No reason provided' }}</span>
                            </div>
                            <div class="detail-row">
                                <span class="detail-label">Requested Staff:</span>
                                <span class="detail-value">{{ swap_request.requested_staff.username }}</span>
                            </div>
                        </div>
                    </div>

                    <div style="text-align: center;">
                        <span style="display: inline-block; background-color: #fee2e2; color: #7f1d1d; padding: 0.35rem 0.75rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600; letter-spacing: 0.3px;">DENIED</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="no-requests">No denied requests</div>
        {% endif %}
    </div>
</section>

<style>
.flash-messages {
    list-style: none;
    padding: 0;
    margin: 1rem 0 1.5rem 0;
}

.flash {
    padding: 1rem;
    margin-bottom: 0.5rem;
    border-radius: 4px;
    border-left: 4px solid;
    font-size: 0.9rem;
}

.flash.success {
    background-color: #064e3b;
    border-color: #10b981;
    color: #d1fae5;
}

.flash.error {
    background-color: #7f1d1d;
    border-color: #ef4444;
    color: #fee2e2;
}

.requests-section {
    margin-bottom: 2.5rem;
}

.status-badge {
    display: inline-block;
    padding: 0.35rem 0.75rem;
    border-radius: 3px;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.5px;
    margin-right: 0.75rem;
}

.status-badge.pending {
    background-color: #fef3c7;
    color: #92400e;
}

.status-badge.approved {
    background-color: #d1fae5;
    color: #065f46;
}

.status-badge.denied {
    background-color: #fee2e2;
    color: #7f1d1d;
}

.requests-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.request-card {
    background-color: #0f172a;
    border: 1px solid #334155;
    border-radius: 6px;
    padding: 1.25rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1.5rem;
    transition: all 0.2s ease;
}

.request-card:hover {
    background-color: #1e293b;
    border-color: #475569;
}

.request-card.approved {
    border-left: 3px solid #10b981;
}

.request-card.denied {
    border-left: 3px solid #ef4444;
}

.request-content {
    flex: 1;
    min-width: 0;
}

.request-header {
    margin-bottom: 0.75rem;
}

.request-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
}

.detail-row {
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.detail-label {
    font-size: 0.75rem;
    color: #94a3b8;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
    margin-bottom: 0.2rem;
}

.detail-value {
    color: #cbd5e1;
    font-size: 0.9rem;
    word-break: break-word;
}

.request-actions {
    display: flex;
    gap: 0.75rem;
    flex-shrink: 0;
}

.request-actions form {
    display: inline;
}

.btn {
    padding: 0.6rem 1rem;
    border: none;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.btn.approve {
    background-color: #10b981;
    color: white;
}

.btn.approve:hover {
    background-color: #059669;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(16, 185, 129, 0.3);
}

.btn.deny {
    background-color: #ef4444;
    color: white;
}

.btn.deny:hover {
    background-color: #dc2626;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
}

.no-requests {
    background-color: #0f172a;
    border: 1px solid #334155;
    border-radius: 6px;
    padding: 2rem;
    text-align: center;
    color: #64748b;
    font-size: 0.95rem;
}

@media (max-width: 1024px) {
    .request-details {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .request-card {
        flex-direction: column;
        align-items: flex-start;
    }

    .request-actions {
        width: 100%;
        flex-direction: column;
    }

    .request-actions form {
        width: 100%;
    }

    .btn {
        width: 100%;
        text-align: center;
    }

    .request-details {
        grid-template-columns: 1fr;
        width: 100%;
    }
}
</style>
{% endblock %}
