{% extends "layout.html" %}
{% block title %}Shift Swap Requests â€” Scheduloid{% endblock %}

{% block nav_actions %}
<a href="{{ url_for('index_views.admin_dashboard') }}" class="link">Back to Dashboard</a>
{% endblock %}

{% block content %}
<!-- Page Header -->
<section class="card">
    <div class="card-header">
        <h1 class="card-title">Shift Swap Requests</h1>
        <p class="card-subtitle">Review and manage staff shift swap requests</p>
    </div>
</section>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <ul class="flash-messages" style="margin-bottom: 1.5rem;">
      {% for category, message in messages %}
        <li class="flash {{ category }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Summary Stats -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Request Summary</h2>
    </div>
    <div class="card-body">
        <div class="flex-row">
            <div class="stat-box amber">
                <p class="stat-label">Pending</p>
                <p class="stat-value">{{ pending_requests|length }}</p>
            </div>
            <div class="stat-box teal">
                <p class="stat-label">Approved</p>
                <p class="stat-value">{{ approved_requests|length }}</p>
            </div>
            <div class="stat-box purple">
                <p class="stat-label">Denied</p>
                <p class="stat-value">{{ denied_requests|length }}</p>
            </div>
        </div>
    </div>
</section>

<!-- Pending Requests -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Pending Requests</h2>
        <p class="card-subtitle">{{ pending_requests|length }} request(s) awaiting review</p>
    </div>
    <div class="card-body">
        {% if pending_requests %}
        <div class="flex-col" style="gap: 1rem;">
            {% for swap_request in pending_requests %}
            <div style="background: #0f172a; border: 1px solid #334155; border-radius: 6px; padding: 1.25rem; display: flex; justify-content: space-between; align-items: center; gap: 1.5rem;">
                <div style="flex: 1;">
                    <p style="margin: 0 0 0.5rem 0; color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</p>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem; font-size: 0.9rem;">
                        <div>
                            <span style="color: #64748b;">Shift Date:</span>
                            <span style="color: #cbd5e1; margin-left: 0.5rem;">{{ swap_request.shift.start_time.strftime('%Y-%m-%d') }}</span>
                        </div>
                        <div>
                            <span style="color: #64748b;">Time:</span>
                            <span style="color: #cbd5e1; margin-left: 0.5rem;">{{ swap_request.shift.start_time.strftime('%H:%M') }} - {{ swap_request.shift.end_time.strftime('%H:%M') }}</span>
                        </div>
                        <div>
                            <span style="color: #64748b;">Requested:</span>
                            <span style="color: #cbd5e1; margin-left: 0.5rem;">{{ swap_request.requested_staff.username }}</span>
                        </div>
                        <div>
                            <span style="color: #64748b;">Reason:</span>
                            <span style="color: #cbd5e1; margin-left: 0.5rem;">{{ swap_request.reason or 'None' }}</span>
                        </div>
                    </div>
                </div>
                <div class="flex-row" style="gap: 0.5rem; flex-shrink: 0;">
                    <form method="POST" style="display: inline;">
                        <input type="hidden" name="request_id" value="{{ swap_request.id }}">
                        <input type="hidden" name="action" value="approve">
                        <button type="submit" class="btn" style="background: #14b8a6; padding: 0.5rem 1rem;">Approve</button>
                    </form>
                    <form method="POST" style="display: inline;">
                        <input type="hidden" name="request_id" value="{{ swap_request.id }}">
                        <input type="hidden" name="action" value="deny">
                        <button type="submit" class="btn" style="background: #ef4444; padding: 0.5rem 1rem;">Deny</button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="background: #0f172a; border-radius: 8px; padding: 2rem; text-align: center;">
            <p style="margin: 0; color: #94a3b8;">No pending requests.</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Approved Requests -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Approved Requests</h2>
    </div>
    <div class="card-body">
        {% if approved_requests %}
        <div class="flex-col" style="gap: 0.75rem;">
            {% for swap_request in approved_requests %}
            <div style="background: #0f172a; border: 1px solid #334155; border-left: 3px solid #14b8a6; border-radius: 6px; padding: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span style="color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</span>
                        <span style="color: #64748b; margin: 0 0.5rem;">swapped with</span>
                        <span style="color: #e2e8f0; font-weight: 600;">{{ swap_request.requested_staff.username }}</span>
                    </div>
                    <span style="background: #064e3b; color: #d1fae5; padding: 0.25rem 0.75rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600;">APPROVED</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="background: #0f172a; border-radius: 8px; padding: 1.5rem; text-align: center;">
            <p style="margin: 0; color: #94a3b8; font-size: 0.9rem;">No approved requests.</p>
        </div>
        {% endif %}
    </div>
</section>

<!-- Denied Requests -->
<section class="card">
    <div class="card-header">
        <h2 class="card-title">Denied Requests</h2>
    </div>
    <div class="card-body">
        {% if denied_requests %}
        <div class="flex-col" style="gap: 0.75rem;">
            {% for swap_request in denied_requests %}
            <div style="background: #0f172a; border: 1px solid #334155; border-left: 3px solid #ef4444; border-radius: 6px; padding: 1rem;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span style="color: #e2e8f0; font-weight: 600;">{{ swap_request.requesting_staff.username }}</span>
                        <span style="color: #64748b; margin: 0 0.5rem;">requested swap with</span>
                        <span style="color: #e2e8f0; font-weight: 600;">{{ swap_request.requested_staff.username }}</span>
                    </div>
                    <span style="background: #7f1d1d; color: #fee2e2; padding: 0.25rem 0.75rem; border-radius: 3px; font-size: 0.75rem; font-weight: 600;">DENIED</span>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div style="background: #0f172a; border-radius: 8px; padding: 1.5rem; text-align: center;">
            <p style="margin: 0; color: #94a3b8; font-size: 0.9rem;">No denied requests.</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
